<?xml version="1.0" encoding="UTF-8" ?>
<openerp>
    <data>
<!-- Document Type -->
        <record id="view_hr_document_type_tree" model="ir.ui.view">
            <field name="name">hr.document.type.tree</field>
            <field name="model">hr.document.type</field>
            <field name="type">tree</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <tree editable="top" string="Types des documents">
                    <field name="name"/>
                    <field name="can_request"/>
                </tree>
            </field>
        </record>
        <record id="view_hr_document_type_search" model="ir.ui.view">
            <field name="name">hr.document.type.search</field>
            <field name="model">hr.document.type</field>
            <field name="type">search</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <search string="Types des documents">
                    <field name="name" select="True"/>
                    <field name="can_request" select="True"/>
                </search>
            </field>
        </record>
        <record id="act_open_hr_document_type_view" model="ir.actions.act_window">
            <field name="name">Types des documents</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.document.type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="search_view_id" ref="view_hr_document_type_search"/>
            <field name="domain">[]</field>
            <field name="context">{}</field>
        </record>
        <menuitem action="act_open_hr_document_type_view" id="menu_hr_document_type" parent="hr.menu_human_resources_configuration" sequence="12"/>
<!-- Document -->
        <record id="view_hr_document_tree" model="ir.ui.view">
            <field name="name">hr.document.tree</field>
            <field name="model">hr.document</field>
            <field name="type">tree</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <tree colors="grey:state=='delivred' ; green:state=='ready' " string="Documents">
                    <field name="employee_id"/>
                    <field name="user_id"/>
                    <field name="type_id"/>
                    <field name="date"/>
                    <field name="name"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        <record id="view_hr_document_form" model="ir.ui.view">
            <field name="name">hr.document.form</field>
            <field name="model">hr.document</field>
            <field name="type">form</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <form string="Documents">
                    <header>
                        <button class="oe_highlight" name="document_confirm" states="draft" string="Confirmer" type="workflow"/>
                        <button name="document_refuse1" states="draft" string="Refuser" type="workflow"/>
                        <button class="oe_highlight" name="document_ready" states="confirm" string="Prêt" type="workflow"/>
                        <button name="document_refuse2" states="confirm" string="Refuser" type="workflow"/>
                        <button class="oe_highlight" name="document_delivered" states="ready" string="Deliver" type="workflow"/>
                        <button name="document_refuse3" states="ready" string="Refuser" type="workflow"/>
                        <field name="state" statusbar_visible="draft,confirm,ready,delivered" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <group name="general">
                                <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" name="name"/>
                                <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" name="date"/>
                            </group>
                            <group name="params">
                                <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" domain="[('can_request','=',True)]" name="type_id"
                                    widget="selection"/>
                                <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" name="employee_id"/>
                                <field name="user_id"/>
                                <field name="company_id"/>

                            </group>
                        </group>
                        <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" colspan="4" name="notes" nolabel="1"
                            placeholder="Ajouter un motif..."/>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="view_hr_document_form_domain" model="ir.ui.view">
            <field name="name">hr.document.form</field>
            <field name="model">hr.document</field>
            <field name="type">form</field>
            <field eval="4" name="priority"/>
            <field name="arch" type="xml">
                <form string="Documents">
                    <header>
                        <button class="oe_highlight" name="document_confirm" states="draft" string="Confirmer" type="workflow"/>
                        <button name="document_refuse1" states="draft" string="Refuser" type="workflow"/>
                        <button class="oe_highlight" name="document_validate" states="confirm" string="Valider" type="workflow"/>
                        <button name="document_refuse2" states="confirm" string="Refuser" type="workflow"/>
                        <button class="oe_highlight" name="document_done" states="validate" string="Approuver" type="workflow"/>
                        <button name="document_refuse3" states="validate" string="Refuser" type="workflow"/>
                        <field name="state" statusbar_visible="draft,confirm,ready,delivered" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" name="name"/>
                                <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" name="date"/>
                            </group>
                            <group>
                                <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" domain="[('can_request','=',True)]" name="type_id"
                                    widget="selection"/>
                                <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" domain="[('user_id','=', uid)]" name="employee_id"
                                    widget="selection"/>
                                <field domain="[('id','=', uid)]" name="user_id"/>
                                <field name="company_id" groups="base.group_multi_company"/>
                            </group>
                        </group>
                        <field attrs="{'readonly':[('state','!=','draft'),('state','!=','confirm')]}" colspan="4" name="notes" nolabel="1"
                            placeholder="Ajouter un motif..."/>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="view_hr_document_search" model="ir.ui.view">
            <field name="name">hr.document.search</field>
            <field name="model">hr.document</field>
            <field name="type">search</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <search string="Documents">
                    <field name="name" select="True"/>
                    <field name="type_id" select="True"/>
                    <field name="employee_id" select="True"/>
                    <field name="user_id" select="True"/>
                    <filter domain="[('state','=', 'draft')]" name="draft" string="Brouillon"/>
                    <filter domain="[('state','=', 'confirm')]" name="confirm" string="Confirmé"/>
                    <filter domain="[('state','=', 'ready')]" name="ready" string="Prêt"/>
                    <filter domain="[('state','=', 'delivered')]" name="delivred" string="Livré"/>
                    <newline/>
                    <filter domain="[('employee_id.user_id','=', uid)]" help="Mes demandes" name="my_requests" string="Mes demandes"/>
                    <filter domain="[('message_unread','=', True)]" name="unread" string="Messages non lus"/>
                    <filter domain="['|',('date','ilike',time.strftime('%%Y-%%m-'))]" name="this_month" string="Ce mois"/>
                    <group expand="0" string="Group By">
                        <filter context="{'group_by':'employee_id'}" domain="[]" icon="terp-partner" string="Employé"/>
                        <filter context="{'group_by':'company_id'}" domain="[]" icon="terp-folder-orange" string="Société" groups="base.group_multi_company" />
                        <filter context="{'group_by':'user_id'}" domain="[]" icon="terp-partner" string="Utilisateur"/>
                        <filter context="{'group_by':'type_id'}" domain="[]" icon="terp-folder-orange" string="Type"/>
                        <filter context="{'group_by':'state'}" domain="[]" icon="terp-stock_effects-object-colorize" string="État"/>
                    </group>
                </search>
            </field>
        </record>
<!-- All -->
        <record id="act_open_hr_document_view_all" model="ir.actions.act_window">
            <field name="name">Documents Administratifs</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.document</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[]</field>
            <field name="context">{}</field>
        </record>
        <record id="act_open_hr_document_view_form_all" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_document_view_all"/>
            <field eval="20" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_document_form"/>
        </record>
        <record id="act_open_hr_document_view_tree_all" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_document_view_all"/>
            <field eval="10" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_hr_document_tree"/>
        </record>
        <menuitem action="act_open_hr_document_view_all" groups="l10n_ma_hr_payroll.group_hr_menu_document"
            id="menu_open_document_all_employees" parent="l10n_ma_hr_payroll.menu_hr_main_administration" sequence="40"/>
<!-- Context -->
        <record id="act_open_hr_document_view_context" model="ir.actions.act_window">
            <field name="name">Documents</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.document</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('employee_id','in', context.get('active_ids',[]))]</field>
            <field name="context">{'default_employee_id' : context.get('active_id', False)}</field>
        </record>
        <record id="act_open_hr_document_view_form" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_document_view_context"/>
            <field eval="20" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_document_form"/>
        </record>
        <record id="act_open_hr_document_view_tree" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_document_view_context"/>
            <field eval="10" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_hr_document_tree"/>
        </record>
        
        
        <!-- Documents -->
        <record id="act_open_document_request_view" model="ir.actions.act_window">
            <field name="name">Documents</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.document</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('employee_id.user_id','=',uid)]</field>
            <field name="context">{ }</field>
        </record>
        <menuitem id="request_document_menu" parent="l10n_ma_hr_payroll.menu_hr_main_request" sequence="0"
                action="act_open_document_request_view" groups="l10n_ma_hr_payroll.group_portal_employee_menu_document"/>
    </data>
</openerp>
