<?xml version="1.0" encoding="UTF-8" ?>
<openerp>
    <data>
<!-- Action called by run payslip form -->
        <record id="act_open_hr_payslip_by_run_context" model="ir.actions.act_window">
            <field name="name">Bulletins de paie</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.payslip</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('payslip_run_id','=',active_id)]</field>
            <field name="context">{'search_default_payslip_run_id': [active_id], 'default_payslip_run_id': active_id}</field>
        </record>
<!-- Adding department on the payslip form -->
        <record id="view_hr_payslip_department_form" model="ir.ui.view">
            <field name="name">hr.payslip.form</field>
            <field name="model">hr.payslip</field>
            <field  name="inherit_id" ref="hr_payroll_account.view_hr_payslip_inherit_form"/>
            <field name="arch" type="xml">
                <xpath expr="//sheet" position="after">
                    <div class="oe_chatter" groups="l10n_ma_hr_payroll.group_hr_company">
                        <field  name="message_follower_ids" widget="mail_followers"/>
                        <field  name="message_ids" widget="mail_thread"/>
                    </div>
                </xpath>
               <!-- <xpath expr="//field[@name='date_to']" position="attributes">
                  <attribute name="on_change">onchange_employee_id(date_from, date_to, employee_id, contract_id)</attribute>
                </xpath> -->
                <xpath expr="//button[@name='refund_sheet']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
<!-- <xpath expr="//button[@name='cancel_sheet']" position="attributes">
                            <attribute name="states">draft,hr_check,confirm,verify,done"</attribute>
                        </xpath> -->
                <xpath expr="//button[@name='action_payslip_cancel']" position="attributes">
                    <attribute name="states">draft,hr_check,confirm,verify,done</attribute>
                </xpath>
                <xpath expr="//button[@name='action_payslip_cancel']" position="before">
                    <button  attrs="{'invisible': [('state2','!=', 'done')]}" class="oe_highlight" name="action_paid" string="Payer" type="object"/>
                    <button  attrs="{'invisible': [('state2','!=', 'paid')]}" name="action_unpaid" string="Marquer impayé" type="object"/>
                </xpath>
                <xpath expr="//button[@name='action_payslip_cancel']" position="after">
                    <button  name="reset_params" states="draft" string="Réinitialiser les paramètres" type="object"/>
                </xpath>
<!--                 <xpath expr="//button[@name='contract_id']" position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>
<xpath expr="//button[@name='refund_sheet']" position="after">
                            <button string="Cancel Payslip" name="cancel_payslip" states="done" type="object"/>
                        </xpath> -->
                <xpath expr="//field[@name='struct_id']" position="after">
                    <field  name="department_id"/>
                </xpath>
                <xpath expr="//field[@name='credit_note']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='journal_id']" position="attributes">
                    <attribute name="widget">selection</attribute>
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='credit_note']" position="after">
                    <field  name="voucher_mode"/>
                    <field  name="voucher_date"/>
                </xpath>
                <xpath expr="//field[@name='paid']" position="after">
                    <field  name="voucher_ok"/>
                </xpath>
                <xpath expr="//field[@name='state']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='state']" position="after">
                    <field  name="state2" statusbar_visible="draft,done,paid" widget="statusbar"/>
                </xpath>
                <xpath expr="//notebook/page[4]" position="after">
                    <page string="Autres information">
                        <group col="4" colspan="4">
                            <group colspan="2">
                                <field  name="job_id"/>
                                <field  name="solde_tout_compte_id"/>
                                <field  name="marital"/>
                                <field  name="wife_situation"/>
                                <field  name="children"/>
                                <field  name="nbr_person_charged"/>
                                <field  name="hire_date"/>
                                <field  name="otherid"/>
                            </group>
                            <group colspan="2">
                                <field  name="address_home"/>
                                <field  name="cnss_ok"/>
                                <field  name="cimr_ok"/>
                            </group>
                            <group colspan="2">
                                <field  name="leave_current_legal"/>
                                <field  name="leave_pris_n_legal"/>
                                <field  name="leave_pris_n1_legal"/>
                                <field  name="leave_holidays_allocation_n_legal"/>
                                <field  name="leave_holidays_allocation_n1_legal"/>
                                <field  name="leave_restant_n_legal"/>
                                <field  name="leave_restant_n1_legal"/>
                                <field  name="leave_left_legal"/>
                            </group>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>
        
        <record id="view_hr_payslip_form" model="ir.ui.view">
            <field name="name">hr.payslip.form</field>
            <field name="model">hr.payslip</field>
            <field  name="inherit_id" ref="hr_payroll.view_hr_payslip_form"/>
            <field name="arch" type="xml">
            	<xpath expr="//field[@name='contract_id']" position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>
            </field>
        </record>
        
        
<!-- Payslip Tree -->
        <record id="view_hr_payslip_state2_tree" model="ir.ui.view">
            <field name="name">hr.payslip.tree</field>
            <field name="model">hr.payslip</field>
            <field  name="inherit_id" ref="hr_payroll.view_hr_payslip_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="before">
                    <field  groups="hr.group_hr_user" name="salary_net" sum="Total"/>
                </xpath>
                <xpath expr="//field[@name='state']" position="after">
                    <field  name="state2"/>
                </xpath>
                <xpath expr="//field[@name='state']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//tree" position="attributes">
                    <attribute name="colors">blue:state in ('draft','verify');black:state == 'done';gray:state in ('cancel','paid')</attribute>
                </xpath>
            </field>
        </record>
<!-- Payslip Search -->
        <record id="view_hr_payslip_state2_search" model="ir.ui.view">
            <field name="name">hr.payslip.search</field>
            <field name="model">hr.payslip</field>
            <field  name="inherit_id" ref="hr_payroll.view_hr_payslip_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='state']" position="attributes">
                    <attribute name="context">{'group_by':'state2'}</attribute>
                </xpath>
                <xpath expr="//filter[2]" position="attributes">
                    <attribute name="domain">[('state2','=','done')]</attribute>
                </xpath>
                <xpath expr="//filter[2]" position="after">
                    <filter  domain="[('state2','=','paid')]" help="Bulletins payés" icon="terp-camera_test" string="Payé"/>
                    <filter  domain="[('state2','=','cancel')]" help="Bulletins annulés" icon="terp-camera_test" string="Annulé"/>
                </xpath>
            </field>
        </record>
<!-- Main menu Security -->
        <record id="hr_payroll.menu_hr_payroll_root" model="ir.ui.menu">
            <field  eval="[(6, 0, [])]" name="groups_id"/>
        </record>
    </data>
</openerp>
