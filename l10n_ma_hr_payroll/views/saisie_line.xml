<?xml version="1.0" encoding="UTF-8" ?>
<openerp>
    <data>
        <record id="view_hr_saisie_line_tree" model="ir.ui.view">
            <field name="name">hr.saisie.line.tree</field>
            <field name="model">hr.saisie.line</field>
            <field name="type">tree</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <tree
                    colors="grey:state in ['done','cancel'];blue:state=='draft';
                    orange:state=='confirm'; green:state=='csv' " string="Ligne de saisie">
                    <field name="date_start"/>
                    <field name="date_end"/>
                    <field invisible="1" name="name"/>
                    <field name="employee_id"/>
                    <field name="contract_id"/>
                    <field name="run_id"/>
                    <field groups="base.group_multi_company" name="company_id"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        <record id="view_hr_saisie_line_form" model="ir.ui.view">
            <field name="name">hr.saisie.line.form</field>
            <field name="model">hr.saisie.line</field>
            <field name="type">form</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <form string="Ligne de saisie">
                    <header>
                        <field name="state" statusbar_visible="draft,csv,confirm,done" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="date_start" readonly="1"/>
                                <field name="date_end" readonly="1"/>
                                <field groups="base.group_multi_company" name="company_id" readonly="1"/>
                                <field name="name" readonly="1"/>
                                <field name="run_id" readonly="1"/>
                            </group>
                            <group>
                                <field name="employee_id" readonly="1"/>
                                <field name="contract_id" readonly="1"/>
                                <field name="based_on" readonly="1"/>
                                <field name="struct_id" readonly="1"/>
                            </group>
                            <group colspan="4">
                                 <!-- TODO RemoveMe -->
                                <button name="propagate"
                                    string="Propagate" type="object" class="oe_link" invisible="1" />
                                 <!-- TODO RemoveMe -->
                                <button name="cancel_propagation"
                                    string="Cancel propagation" type="object" class="oe_link" invisible="1" />
                            </group>
                        </group>
                        <notebook colspan="4">
                            <page string="Général">
                                <group>
                                    <group string="Heures/Jours">
                                        <field name="normal" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                        <field name="rate" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                        <field name="fix_leave_paid" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                        <field name="leave_paid" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                    </group>
                                    <group string="Notes de frais">
                                        <field name="expense_paid" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                        <field name="expense_to_pay" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                    </group>
                                    <group string="Kilométrage">
                                        <field name="cv" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                        <field name="kilometrage" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                    </group>
                                    <group colspan="4" string="Notifications">
                                        <field colspan="4" name="notes" nolabel="1" attrs="{'readonly':[('state','not in',['draft','csv'])]}"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Congés et absences">
                                <field attrs="{'readonly':[('state','not in',['draft','csv'])]}" colspan="4"
                                    name="leave_ids" nolabel="1">
                                    <tree editable="bottom" string="Congés et absences">
                                        <field name="type_id" widget="selection"/>
                                        <field name="value"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Heures supplémentaires">
                                <field attrs="{'readonly':[('state','not in',['draft','csv'])]}" colspan="4"
                                    name="hs_ids" nolabel="1">
                                    <tree editable="bottom" string="Heures supplémentaires">
                                        <field name="type_id" widget="selection"/>
                                        <field name="value"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Primes et indémnités">
                                <field attrs="{'readonly':[('state','not in',['draft','csv'])]}" colspan="4"
                                    name="rubrique_ids" nolabel="1">
                                    <tree editable="bottom" string="Primes et indémnités">
                                        <field name="type_id" widget="selection"/>
                                        <field name="value"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Avantages">
                                <field attrs="{'readonly':[('state','not in',['draft','csv'])]}" colspan="4"
                                    name="avantage_ids" nolabel="1">
                                    <tree editable="bottom" string="Avantages">
                                        <field name="type_id" widget="selection"/>
                                        <field name="value"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Avances et prêts">
                                <field attrs="{'readonly':[('state','not in',['draft','csv'])]}" colspan="4"
                                    name="avance_ids" nolabel="1">
                                    <tree editable="bottom" string="Avances et prêts">
                                        <field name="type_id" widget="selection"/>
                                        <field name="value"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="view_hr_saisie_line_search" model="ir.ui.view">
            <field name="name">hr.saisie.line.search</field>
            <field name="model">hr.saisie.line</field>
            <field name="type">search</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <search string="Ligne de saisie">
                    <field name="name" select="True"/>
                    <field name="employee_id" select="True"/>
                    <field name="contract_id" select="True"/>
                    <field name="company_id" select="True"/>
                    <field name="date_start" select="True"/>
                    <field name="date_end" select="True"/>
                    <filter domain="[('state','=', 'draft')]" name="draft" string="Brouillon"/>
                    <filter domain="[('state','in', ['confirm','csv'])]" name="pending"
                        string="En attente"/>
                    <filter domain="[('state','=', 'cancel')]" name="cancel" help="Annulé"/>
                    <filter domain="[('state','=', 'done')]" name="done" help="Terminé"/>
                    <newline/>
                    <filter domain="[('date_start','ilike',time.strftime('%%Y-%%m-'))]"
                        name="this_month" string="Ce mois"/>
                    <group expand="0" string="Group By">
                        <filter context="{'group_by':'employee_id'}" domain="[]" icon="terp-partner"
                            string="Employé"/>
                        <filter context="{'group_by':'contract_id'}" domain="[]" icon="terp-partner"
                            string="Contrat"/>
                        <filter context="{'group_by':'company_id'}" domain="[]" icon="terp-partner"
                            string="Société"/>
                        <filter context="{'group_by':'date_start'}" domain="[]" icon="terp-folder-orange"
                            string="Date début"/>
                        <filter context="{'group_by':'state'}" domain="[]"
                            icon="terp-stock_effects-object-colorize" string="État"/>
                    </group>
                </search>
            </field>
        </record>
        <!-- ALL -->
        <record id="act_open_hr_saisie_line_view" model="ir.actions.act_window">
            <field name="name">Ligne de saisie</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.saisie.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_hr_saisie_line_search"/>
            <field name="domain">[]</field>
            <field name="context">{'search_default_pending' : 1}</field>
        </record>
        <record id="act_open_hr_saisie_line_view_form" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_saisie_line_view"/>
            <field eval="20" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_saisie_line_form"/>
        </record>
        <record id="act_open_hr_saisie_line_view_tree" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_saisie_line_view"/>
            <field eval="10" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_hr_saisie_line_tree"/>
        </record>
        <menuitem action="act_open_hr_saisie_line_view" groups="l10n_ma_hr_payroll.group_hr_menu_saisie"
            id="menu_hr_saisie_line" parent="menu_hr_saisie_main" sequence="2"/>
        <!-- Context -->
        <record id="act_open_hr_saisie_line_view_context" model="ir.actions.act_window">
            <field name="name">Ligne de saisie</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.saisie.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_hr_saisie_line_search"/>
            <field name="domain">[('employee_id','=',active_id)]</field>
            <field name="context">{'search_default_employee_id': [active_id], 'default_employee_id': active_id}</field>
        </record>
        <record id="act_open_hr_saisie_line_view_form_context" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_saisie_line_view_context"/>
            <field eval="20" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_saisie_line_form"/>
        </record>
        <record id="act_open_hr_saisie_line_view_tree_context" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_saisie_line_view_context"/>
            <field eval="10" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_hr_saisie_line_tree"/>
        </record>
    </data>
</openerp>
