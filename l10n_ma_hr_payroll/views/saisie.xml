<?xml version="1.0" encoding="UTF-8" ?>
<openerp>
    <data>
      <!-- Saisie line Action -->
      <record id="act_open_hr_saisie_line_view_by_context" model="ir.actions.act_window">
          <field name="name">Lignes de saisie</field>
          <field name="type">ir.actions.act_window</field>
          <field name="res_model">hr.saisie.line</field>
          <field name="view_type">form</field>
          <field name="view_mode">tree,form</field>
          <field name="domain">[('run_id','=',context.get('active_id'))]</field>
          <field name="context">{'search_default_run_id' : context.get('active_id'), 'default_run_id': context.get('active_id')}</field>
      </record>
<!-- Batch -->
        <record id="view_hr_saisie_run_tree" model="ir.ui.view">
            <field name="name">hr.saisie.run.tree</field>
            <field name="model">hr.saisie.run</field>
            <field name="type">tree</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <tree colors="grey:state in ['done','cancel'];blue:state=='draft'; orange:state=='confirm'; green:state=='csv' "
                    fonts="bold:message_unread==True" string="Lot de saisie">
                    <field name="name"/>
                    <field name="date_start"/>
                    <field name="date_end"/>
                    <field groups="base.group_multi_company" name="company_id"/>
                    <field name="state"/>
                    <field invisible="1" name="message_unread"/>
                </tree>
            </field>
        </record>
        <record id="view_hr_saisie_run_form" model="ir.ui.view">
            <field name="name">hr.saisie.run.form</field>
            <field name="model">hr.saisie.run</field>
            <field name="type">form</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <form string="Lot de saisie">
                    <header>
                        <button class="oe_highlight" name="generate" states="draft" string="Générer" type="object"/>
                        <button class="oe_highlight" name="saisie_csv" states="draft" string="Verrouiller les paramètres" type="object"/>
                        <button name="saisie_refuse1" states="draft" string="Annuler" type="workflow"/>
                        <button class="oe_highlight" name="saisie_confirm" states="csv" string="Confirmer" type="workflow"/>
                        <button name="generate" states="csv" string="Générer à nouveau les lignes" type="object"/>
                        <button name="saisie_refuse0" states="csv" string="Annuler" type="workflow"/>
                        <button class="oe_highlight" name="saisie_done" states="confirm" string="Fermer" type="workflow"/>
                        <button name="saisie_refuse2" states="confirm" string="Annuler" type="workflow"/>
                        <button  name="import_csv" states="csv" string="Import CSV" type="object"/>
                        <button groups="l10n_ma_hr_payroll.group_forbidden_action" name="saisie_refuse3" states="done" string="Annuler" type="workflow"/>
                        <button  name="export_csv" states="csv" string="Export CSV" type="object"/>
                        <field name="state" statusbar_visible="csv,confirm,done" widget="statusbar"/>
                    </header>
                    <sheet>
                      <h1><field name="name"/></h1>
                      <div class="oe_button_box" name="button_box">
                          <button class="oe_stat_button" icon="fa-list" name="%(act_open_hr_saisie_line_view_by_context)d" type="action">
                              <field name="saisie_line_count" string="Lignes" widget="statinfo"/>
                          </button>
                      </div>
                        <group colspan="4" col="4">
                            <group colspan="2">
                                <field attrs="{'readonly':[('state','not in',['draft'])]}" name="fiscalyear_id" widget="selection"  groups="l10n_ma_hr_payroll.group_paie_interface_helper"/>
                                <field attrs="{'readonly':[('state','not in',['draft'])]}" name="period_id" widget="selection" groups="l10n_ma_hr_payroll.group_paie_interface_helper"/>
                                <field attrs="{'readonly':[('state','not in',['draft'])]}" name="date_start"/>
                                <field attrs="{'readonly':[('state','not in',['draft'])]}" name="date_end"/>
                            </group>
                            <group colspan="2" groups="l10n_ma_hr_payroll.group_paie_interface_department" name="department">
                                <div class="style_department">
                                    <separator  string="Limiter les départements"/>
                                    <field  name="departments_id" widget="many2many_checkboxes"/>
                                </div>
                            </group>
                            <group colspan="2">
                                <field attrs="{'readonly':[('state','not in',['draft'])]}" name="category_ids" widget="many2many_tags"/>
                                <field attrs="{'readonly':[('state','not in',['draft'])]}" groups="base.group_multi_company" name="company_id" widget="selection"/>
                            </group>
                        </group>
                        <notebook colspan="4">
                            <page string="Lignes">
                                <field attrs="{'readonly':[('state','not in',['draft'])]}" colspan="4" name="line_ids" nolabel="1">
                                    <field name="employee_id"/>
                                    <field name="contract_id"/>
                                    <field groups="base.group_multi_company" name="company_id"/>
                                    <field name="state"/>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="view_hr_saisie_run_search" model="ir.ui.view">
            <field name="name">hr.saisie.run.search</field>
            <field name="model">hr.saisie.run</field>
            <field name="type">search</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <search string="Lot de saisie">
                    <field name="name" select="True"/>
                    <field name="company_id" select="True"/>
                    <field name="date_start" select="True"/>
                    <field name="date_end" select="True"/>
                    <filter domain="[('state','=', 'draft')]" name="draft" string="Brouillon"/>
                    <filter domain="[('state','in', ['confirm','csv'])]" name="pending" string="En attente"/>
                    <filter domain="[('state','=', 'cancel')]" name="cancel" help="Annulé"/>
                    <filter domain="[('state','=', 'done')]" name="done" help="Terminé"/>
                    <newline/>
                    <filter domain="[('message_unread','=', True)]" name="unread" string="Messages non lus"/>
                    <filter domain="[('date_start','ilike',time.strftime('%%Y-%%m-'))]" name="this_month" string="Ce mois"/>
                    <group expand="0" string="Group By">
                        <filter context="{'group_by':'company_id'}" domain="[]" icon="terp-partner" string="Société"/>
                        <filter context="{'group_by':'date_start'}" domain="[]" icon="terp-folder-orange" string="Date début"/>
                        <filter context="{'group_by':'period_id'}" domain="[]" icon="terp-folder-orange" string="Période"/>
                        <filter context="{'group_by':'state'}" domain="[]" icon="terp-stock_effects-object-colorize" string="État"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="act_open_hr_saisie_run_view" model="ir.actions.act_window">
            <field name="name">Lot de saisie</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.saisie.run</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_hr_saisie_run_search"/>
            <field name="domain">[]</field>
            <field name="context">{'search_default_pending' : 1}</field>
        </record>
        <record id="act_open_hr_saisie_run_view_form" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_saisie_run_view"/>
            <field eval="20" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_saisie_run_form"/>
        </record>
        <record id="act_open_hr_saisie_run_view_tree" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="act_open_hr_saisie_run_view"/>
            <field eval="10" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_hr_saisie_run_tree"/>
        </record>
        <menuitem action="act_open_hr_saisie_run_view" groups="l10n_ma_hr_payroll.group_hr_menu_saisie" id="menu_hr_saisie_run" parent="menu_hr_saisie_main"
            sequence="1"/>

    </data>
</openerp>
